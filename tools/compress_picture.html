<html>

<head>
  <meta charSet="utf-8" />
  <title data-rh="true">图片压缩</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <meta name="renderer" content="webkit" />
  <meta name="force-rendering" content="webkit" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" property="og:description" content="一键式操作、多种格式压缩、支持批量操作、压缩质量可调节， 有效解决文件过大难题!" />
  <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
  <style>
    #app {
      max-width: 800px;
      margin: 0 auto;
    }
    .is-fixed{
      position: sticky;
    }
    .AppHeader-inner{
      display: flex;
    }
    .AppHeader-Tabs{
      display: flex;

    }
    li {
    list-style-type: none;
    padding-left: 15px;
    padding-right: 15px
}
  </style>
</head>

<body>
  <div id="app">
    <header role="banner" class="Sticky AppHeader is-fixed css-1x8hcdw" 
      style="width: 100%; top: 0px;">
      <div class="AppHeader-inner css-qqgmyv"><a href="//www.zhihu.com" aria-label="知乎"><svg viewBox="0 0 64 30"
            fill="#0066FF" width="64" height="30" class="css-1hlrcxk">
            <path
              d="M29.05 4.582H16.733V25.94h3.018l.403 2.572 4.081-2.572h4.815V4.582zm-5.207 18.69l-2.396 1.509-.235-1.508h-1.724V7.233h6.78v16.04h-2.425zM14.46 14.191H9.982c0-.471.033-.954.039-1.458v-5.5h5.106V5.935a1.352 1.352 0 0 0-.404-.957 1.378 1.378 0 0 0-.968-.396H5.783c.028-.088.056-.177.084-.255.274-.82 1.153-3.326 1.153-3.326a4.262 4.262 0 0 0-2.413.698c-.57.4-.912.682-1.371 1.946-.532 1.453-.997 2.856-1.31 3.693C1.444 8.674.28 11.025.28 11.025a5.85 5.85 0 0 0 2.52-.61c1.119-.593 1.679-1.502 2.054-2.883l.09-.3h2.334v5.5c0 .5-.045.982-.073 1.46h-4.12c-.71 0-1.39.278-1.893.775a2.638 2.638 0 0 0-.783 1.874h6.527a17.717 17.717 0 0 1-.778 3.649 16.796 16.796 0 0 1-3.012 5.273A33.104 33.104 0 0 1 0 28.74s3.13 1.175 5.425-.954c1.388-1.292 2.631-3.814 3.23-5.727a28.09 28.09 0 0 0 1.12-5.229h5.967v-1.37a1.254 1.254 0 0 0-.373-.899 1.279 1.279 0 0 0-.909-.37z">
            </path>
            <path
              d="M11.27 19.675l-2.312 1.491 5.038 7.458a6.905 6.905 0 0 0 .672-2.218 3.15 3.15 0 0 0-.28-2.168l-3.118-4.563zM51.449 15.195V5.842c4.181-.205 7.988-.405 9.438-.483l.851-.05c.387-.399.885-2.395.689-3.021-.073-.25-.213-.666-.638-.555a33.279 33.279 0 0 1-4.277.727c-2.766.321-3.97.404-7.804.682-6.718.487-12.709.72-12.709.72a2.518 2.518 0 0 0 .788 1.834 2.567 2.567 0 0 0 1.883.706c2.278-.095 5.598-.25 8.996-.41v9.203h-12.78c0 .703.281 1.377.783 1.874a2.69 2.69 0 0 0 1.892.777h10.105v7.075c0 .887-.464 1.192-1.231 1.214h-3.92a4.15 4.15 0 0 0 .837 1.544 4.2 4.2 0 0 0 1.403 1.067 6.215 6.215 0 0 0 2.71.277c1.36-.066 2.967-.826 2.967-3.57v-7.607h11.28c.342 0 .67-.135.91-.374.242-.239.378-.563.378-.902v-1.375H51.449z">
            </path>
            <path
              d="M42.614 8.873a2.304 2.304 0 0 0-1.508-.926 2.334 2.334 0 0 0-1.727.405l-.376.272 4.255 5.85 2.24-1.62-2.884-3.98zM57.35 8.68l-3.125 4.097 2.24 1.663 4.517-5.927-.375-.277a2.32 2.32 0 0 0-1.722-.452 2.327 2.327 0 0 0-1.536.896z">
            </path>
          </svg></a>
        <ul  class="Tabs AppHeader-Tabs css-g0ay3v">
          <li role="tab" class="Tabs-item AppHeader-Tab Tabs-item--noMeta"><a
              class="Tabs-link AppHeader-TabsLink is-active css-1f6tgea" tabindex="0" data-za-not-track-link="true"
              href="//www.zhihu.com/">首页</a></li>
          <li role="tab" class="Tabs-item AppHeader-Tab Tabs-item--noMeta"><a
              class="Tabs-link AppHeader-TabsLink css-1f6tgea" tabindex="0" data-za-not-track-link="true"
              href="//www.zhihu.com/xen/vip-web">会员</a></li>
          <li role="tab" class="Tabs-item AppHeader-Tab Tabs-item--noMeta"><a
              class="Tabs-link AppHeader-TabsLink css-1f6tgea" tabindex="0" data-za-not-track-link="true"
              href="//www.zhihu.com/explore">发现</a></li>
          <li role="tab" class="Tabs-item AppHeader-Tab Tabs-item--noMeta"><a
              class="Tabs-link AppHeader-TabsLink css-1f6tgea" tabindex="0" data-za-not-track-link="true"
              href="//www.zhihu.com/question/waiting">等你来答</a></li>
        </ul>
      </div>

    </header>
    <input id="file" type="file" capture="microphone" accept="image/*" />
    <br />压缩后的图片(点击图片可下载压缩后图片)：<span id="sz"></span>
    <br />
    <a id="download_a">

      <img id="pic" />
    </a>
  </div>
  <script>
    $("#file").change(function () {
      var m_this = this; cutImageBase64(m_this, null, 900, 0.7);
    })
    function cutImageBase64(m_this, id, wid, quality) {
      var file = m_this.files[0]; var URL = window.URL || window.webkitURL; var blob = URL.createObjectURL(file);
      var base64;
      var img = new Image();
      img.src = blob;
      img.onload = function () {
        var that = this;
        //生成比例
        var w = that.width, h = that.height, scale = w / h; w = wid || w; h = w / scale;
        //生成canvasvar 
        canvas = document.createElement('canvas');
        var ctx = canvas.getContext('2d');
        $(canvas).attr({ width: w, height: h });
        ctx.drawImage(that, 0, 0, w, h);
        // 生成base64
        base64 = canvas.toDataURL('image/jpeg', quality || 0.9);
        document.getElementById("pic").src = base64;
        document.getElementById("download_a").href = base64;
        document.getElementById("download_a").download = m_this.files[0].name;
        document.getElementById("sz").innerHTML = parseInt(imageSize(base64) / 1024, 0) + "kb";
      };
    }

    function imageSize(base64Str) {
      const indexBase64 = base64Str.indexOf('base64,');
      if (indexBase64 < 0) return -1;
      const str = base64Str.substr(indexBase64 + 6);
      return (str.length * 0.75).toFixed(2);
    }

  </script>
</body>

</html>